#!/sbin/runscript
# Copyright 1999-2002 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License, v2 or later
# $Header$


depend() {
	need checkroot
}

start() {
	# LVM support for /usr, /home, /opt ....
	# This should be done *before* checking local
	# volumes, or they never get checked.
	if [ -x /sbin/vgchange -a -f /etc/lvmtab ]
	then
		ebegin "Setting up the Logical Volume Manager"
		#still echo stderr for debugging
		/sbin/vgscan && /sbin/vgchange -a y >/dev/null
		eend $? "Failed to setup the LVM"
	fi

	ebegin "Checking all filesystems"
	fsck -R -A -a
	if [ "$?" -eq 0 ]
	then
		eend 0
	elif [ "$?" -eq 1 ]
	then
		ewend 1 "Filesystem errors corrected."
		#everything should be ok, so return a pass
		return 0
	else
		eend 2 "Fsck could not correct all errors, manual repair needed"
		/sbin/sulogin ${CONSOLE}
	fi
}


# vim:ts=4
