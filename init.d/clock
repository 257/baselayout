#!/sbin/runscript
# Copyright 1999-2002 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License, v2 or later
# $Header$


depend() {
	need localmount
}

start() {
	local myopts=""
	local TBLURB=""
	if [ ! -f /etc/adjtime ]
	then
		echo "0.0 0 0.0" > /etc/adjtime
	fi
	if [ "$CLOCK" = "UTC" ]
	then
		myopts="--utc"
		TBLURB="[UTC]"
	else
		myopts="--localtime"
		TBLURB="[Local Time]"
	fi

	if [ -x /sbin/hwclock ]
	then
		ebegin "Setting system clock to hardware clock ${TBLURB}"
			/sbin/hwclock --adjust ${myopts} >/dev/null 1>&2
			/sbin/hwclock --hctosys ${myopts} >/dev/null 1>&2 
		eend 0 
	else
		eend 1 "hwclock executable not found"
	fi
}

stop() {
	local myopts=""
	local TBLURB=""
        if [ "$CLOCK" = "UTC" ]
	then
		myopts="--utc"
		TBLURB="[UTC]"
	else
		myopts="--localtime"
		TBLURB="[Local Time]"
	fi

	if [ -x /sbin/hwclock ]
	then
		ebegin "Syncing hardware clock to system clock ${TBLURB}"
			/sbin/hwclock --systohc ${myopts} >/dev/null 1>&2
		eend 0
	else
		eend 1 "hwclock executable not found"
	fi
}
												
