#!/sbin/runscript
# Copyright 1999-2002 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License, v2 or later
# $Header$


depend() {
	need bootmisc localmount
#	use logger
}

start() {
	[ -f /proc/modules ] || return
	[ -e /sbin/depmod ] || return
	ebegin "Calculating module dependencies"
	update-modules > /dev/null
	depmod -a > /dev/null
	eend $?

	# Loop over every line in /etc/modules.autoload.
	(cat /etc/modules.autoload; echo) | # make sure there is a LF at the end
	while read module args
	do
		case "$module" in
			\#*|"") continue ;;
		esac
		ebegin "  Loading module $module"
		modprobe $module $args >/dev/null 2>&1
		eend $?
	done
	echo

	#
	# Just in case a sysadmin prefers generic symbolic links in
	# /lib/modules/boot for boot time modules we will load these modules
	#
	if [ -n "`modprobe -l -t boot`" ]
	then
		modprobe -a -t boot \*
	fi

	return
}
